{% extends 'layout.html' %}

{% block title %}采购订单列表 - 书店管理系统{% endblock %}

{% block header %}采购管理{% endblock %}

{% block header_buttons %}
<div>
    <a href="/purchases/add" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> 创建采购订单
    </a>
</div>
{% endblock %}

{% block content %}
<!-- 搜索和筛选 -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold">搜索</h6>
    </div>
    <div class="card-body">
        <form id="search-form">
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="order_id" class="form-label">订单号</label>
                    <input type="text" class="form-control" id="order_id" name="order_id">
                </div>
                <div class="col-md-3">
                    <label for="supplier" class="form-label">供应商</label>
                    <input type="text" class="form-control" id="supplier" name="supplier">
                </div>
                <div class="col-md-3">
                    <label for="status" class="form-label">状态</label>
                    <select class="form-select" id="status" name="status">
                        <option value="">全部</option>
                        <option value="ordered">已下单</option>
                        <option value="received">已入库</option>
                        <option value="partial">部分入库</option>
                        <option value="cancelled">已取消</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="date_range" class="form-label">日期范围</label>
                    <select class="form-select" id="date_range" name="date_range">
                        <option value="">全部时间</option>
                        <option value="today">今天</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                        <option value="quarter">本季度</option>
                        <option value="year">本年</option>
                    </select>
                </div>
                <div class="col-12 mt-3">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search"></i> 搜索
                    </button>
                    <button type="reset" class="btn btn-secondary">
                        <i class="bi bi-arrow-clockwise"></i> 重置
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- 订单列表 -->
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold">采购订单列表</h6>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>订单号</th>
                        <th>供应商</th>
                        <th>下单日期</th>
                        <th>预计到货</th>
                        <th>状态</th>
                        <th>金额</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="orders-list">
                    <tr>
                        <td colspan="7" class="text-center">加载中...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- 无数据提示 -->
        <div id="no-data-message" class="text-center py-5" style="display: none;">
            <i class="bi bi-inbox-fill" style="font-size: 3rem;"></i>
            <h5 class="mt-3">没有找到符合条件的采购订单</h5>
            <p class="text-muted">尝试修改搜索条件或创建新的采购订单</p>
            <a href="/purchases/add" class="btn btn-primary mt-2">
                <i class="bi bi-plus-circle"></i> 创建采购订单
            </a>
        </div>

        <!-- 加载中提示 -->
        <div id="loading-indicator" class="text-center py-5" style="display: none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">加载中...</span>
            </div>
            <p class="mt-2">正在加载数据，请稍候...</p>
        </div>

        <!-- 分页 -->
        <nav aria-label="Page navigation" class="mt-4">
            <ul class="pagination justify-content-center" id="pagination">
                <!-- 分页链接将动态生成 -->
            </ul>
        </nav>
    </div>
</div>

<!-- 取消订单确认对话框 -->
<div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">确认取消订单</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>确定要取消订单 <span id="cancel-order-id" class="fw-bold"></span> 吗？此操作无法撤销。</p>
                <div class="mb-3">
                    <label for="cancel-reason" class="form-label">取消原因</label>
                    <textarea class="form-control" id="cancel-reason" rows="3" required></textarea>
                </div>
                <div class="alert alert-danger" id="cancel-error" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">返回</button>
                <button type="button" class="btn btn-danger" id="confirm-cancel">确认取消</button>
            </div>
        </div>
    </div>
</div>

<!-- 入库确认对话框 -->
<div class="modal fade" id="receiveOrderModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">确认入库</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="receive-form">
                    <p>请确认每本书籍的实际入库数量：</p>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>ISBN</th>
                                    <th>书名</th>
                                    <th>订购数量</th>
                                    <th>实际入库</th>
                                </tr>
                            </thead>
                            <tbody id="receive-items">
                            </tbody>
                        </table>
                    </div>
                    <div class="mb-3">
                        <label for="receive-notes" class="form-label">备注</label>
                        <textarea class="form-control" id="receive-notes" rows="3"></textarea>
                    </div>
                </form>
                <div class="alert alert-danger" id="receive-error" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-success" id="confirm-receive">确认入库</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/purchase.js"></script>
{% endblock %}