{% extends 'layout.html' %}

{% block title %}添加采购订单 - 书店管理系统{% endblock %}

{% block header %}添加采购订单{% endblock %}

{% block header_buttons %}
<div>
    <a href="/purchases" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> 返回订单列表
    </a>
</div>
{% endblock %}

{% block content %}
<div class="row">
    <!-- 左侧：图书搜索和结果 -->
    <div class="col-md-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold">图书搜索</h6>
            </div>
            <div class="card-body">
                <form id="book-search-form">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="输入ISBN、书名或作者..." id="book-search">
                        <button class="btn btn-primary" type="submit">
                            <i class="bi bi-search"></i> 搜索
                        </button>
                    </div>
                </form>

                <!-- 搜索结果 -->
                <div class="mt-3">
                    <h6 class="text-muted mb-2">搜索结果</h6>
                    <div id="search-loading" style="display: none;" class="text-center py-3">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">正在搜索...</span>
                        </div>
                        <p>正在搜索...</p>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered" id="search-results-table">
                            <thead>
                                <tr>
                                    <th>ISBN</th>
                                    <th>书名</th>
                                    <th>作者</th>
                                    <th>价格</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="search-results">
                                <tr>
                                    <td colspan="5" class="text-center">请输入关键词搜索图书</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 右侧：采购订单表单 -->
    <div class="col-md-6">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold">采购订单</h6>
            </div>
            <div class="card-body">
                <!-- 供应商信息 -->
                <div class="mb-3">
                    <label for="supplier-name" class="form-label">供应商名称</label>
                    <input type="text" class="form-control" id="supplier-name" required>
                </div>
                <div class="mb-3">
                    <label for="expected-date" class="form-label">预计到货日期</label>
                    <input type="date" class="form-control" id="expected-date">
                </div>
                <div class="mb-3">
                    <label for="order-notes" class="form-label">备注</label>
                    <textarea class="form-control" id="order-notes" rows="2"></textarea>
                </div>

                <!-- 采购订单表格 -->
                <div class="table-responsive">
                    <table class="table table-bordered" id="order-table">
                        <thead>
                            <tr>
                                <th>书名</th>
                                <th>单价</th>
                                <th>数量</th>
                                <th>小计</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="order-items">
                            <tr>
                                <td colspan="5" class="text-center">订单为空</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-end fw-bold">总计:</td>
                                <td id="order-total" class="fw-bold">¥0.00</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="alert alert-danger" id="add-order-error" style="display: none;"></div>

                <div class="d-grid gap-2 mt-3">
                    <button class="btn btn-primary" id="submit-order-btn" disabled>
                        <i class="bi bi-check-circle"></i> 提交采购订单
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 调整数量和价格Modal -->
<div class="modal fade" id="adjustItemModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">调整数量和价格</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="book-title-display" class="form-label">图书</label>
                    <input type="text" class="form-control" id="book-title-display" readonly>
                </div>
                <div class="mb-3">
                    <label for="adjust-price" class="form-label">单价 (¥)</label>
                    <input type="number" class="form-control" id="adjust-price" step="0.01" min="0">
                </div>
                <div class="mb-3">
                    <label for="adjust-quantity" class="form-label">数量</label>
                    <input type="number" class="form-control" id="adjust-quantity" min="1">
                </div>
                <div class="alert alert-danger" id="adjust-error" style="display: none;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" id="confirm-adjust">确认</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/purchase.js"></script>
{% endblock %}