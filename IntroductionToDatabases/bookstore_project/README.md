# 书店管理系统

## 项目介绍

这是一个基于 Flask 和现代前端技术栈构建的书店管理系统，旨在帮助书店高效管理图书库存、销售、进货和财务等核心业务流程。系统提供了友好的用户界面和完整的功能模块，适用于中小型书店的日常运营管理。

## 功能设计

### 系统架构

- **前端**：HTML5, CSS3, JavaScript, Bootstrap 5
- **后端**：Python Flask RESTful API
- **数据库**：PostgreSQL

### 核心功能模块

1. **图书管理**
   - **图书信息的增删改查**：完整管理图书的各项信息，包括ISBN、书名、作者、出版社、零售价、库存等
   - **图书库存管理**：实时跟踪每本书的库存状况，支持库存调整
   - **库存预警功能**：当图书库存低于阈值时自动发出预警，便于及时补货
   - **图书搜索**：支持通过书名、作者、ISBN等多维度搜索图书

2. **销售管理**
   - **销售录入**：便捷的图书销售操作界面，支持选择图书、输入数量和价格
   - **销售记录查询**：支持按日期范围查询销售记录，清晰记录每笔交易
   - **销售统计分析**：提供图书销售排行、销售额统计等分析功能
   - **销售员业绩查询**：统计每位销售员的销售单数、销售数量和销售金额

3. **进货管理**
   - **进货单创建与管理**：创建和管理进货单，支持添加已有图书或新书
   - **新书入库操作**：将进货的新书添加到库存系统，设置零售价格
   - **进货状态追踪**：清晰记录进货单的状态（未付款、已付款、已退货）
   - **进货记录查询与筛选**：提供多种筛选条件，便于查找历史进货记录
   - **快速进货**：从库存预警直接进入进货流程，提升补货效率

4. **财务管理**
   - **财务概览**：总收入、总支出、总利润的直观展示
   - **财务记录查询**：按时间、类型等筛选查询所有财务记录
   - **月度财务统计**：按月统计收入、支出、利润，提供表格和图表双重展示
   - **销售利润分析**：分析各类图书的销售利润率、单本利润和总利润
   - **环比增长分析**：计算本月与上月的利润环比增长情况

5. **用户管理**（超级管理员专属）
   - **用户账号管理**：创建、编辑、删除用户账号
   - **角色权限控制**：分配用户角色（普通管理员或超级管理员）
   - **员工信息管理**：维护员工的姓名、工号、性别、年龄等基本信息
   - **密码管理**：重置用户密码，确保账号安全

6. **首页/控制台**
   - **库存总览**：总图书种类和库存预警图书数量
   - **销售概况**：今日销量和销售额的实时显示
   - **财务概况**：本月收入和支出的快速查看
   - **销售排行榜**：近期图书销售排行
   - **库存预警列表**：展示需要补货的图书及快速进货入口

### 数据库设计

系统主要包含以下数据表：
- `user` - 用户信息表
- `book` - 图书信息表
- `sale_record` - 销售记录表
- `purchase_order` - 进货单表
- `purchase_detail` - 进货单明细表
- `financial_record` - 财务记录表

同时包含多个存储过程和视图，用于处理复杂业务逻辑和数据统计。

## 项目部署和使用

### 环境要求

- Python 3.8+
- PostgreSQL 12+
- Node.js 14+ (可选，用于开发)

### 后端部署

1. **安装依赖**
   ```bash
   cd backend
   pip install -r requirements.txt
   ```

2. **初始化数据库**
```bash
   # 登录PostgreSQL
   psql -U postgres
   
   # 创建数据库
   CREATE DATABASE bookstore_management WITH ENCODING='UTF-8';
   
   # 退出psql
   \q
   
   # 设置客户端编码为UTF-8（Windows系统）
   set PGCLIENTENCODING=UTF-8
   
   # 导入数据库初始化脚本
   psql -U postgres -d bookstore_management -f db/init_database.sql
   psql -U postgres -d bookstore_management -f db/create_views.sql
   psql -U postgres -d bookstore_management -f db/create_functions.sql
   ```

3. **启动**
   ```bash
   python run.py
   ```

### 系统使用

1. **初始登录**
   - 默认超级管理员账号：admin
   - 默认密码：admin123

2. **基本操作流程**
   - 管理图书：添加、编辑、删除图书信息
   - 处理销售：记录图书销售情况
   - 管理进货：创建进货单，处理新书入库
   - 查看财务：分析财务状况，查看收支情况
   - 管理用户：添加新用户，设置权限

## 系统特性

1. **权限控制**
   - 超级管理员：拥有所有权限，包括用户管理
   - 普通管理员：拥有除用户管理外的所有权限

2. **智能库存管理**
   - 自动库存预警
   - 快速进货操作

3. **实时数据分析**
   - 销售业绩统计
   - 财务状况分析
   - 利润率计算

4. **数据完整性保护**
   - 事务管理
   - 数据验证
   - 关系完整性约束

## 开发与扩展

### 项目结构

```
backend/
    app.py                  # 应用入口点
    models.py               # 数据模型定义
    requirements.txt        # 依赖管理
    routes/                 # API路由模块
        book_routes.py      # 图书管理路由
        finance_routes.py   # 财务管理路由
        purchase_routes.py  # 进货管理路由
        sale_routes.py      # 销售管理路由
        user_routes.py      # 用户管理路由
db/
    create_functions.sql    # 存储过程和函数
    create_views.sql        # 视图定义
    init_database.sql       # 数据库初始化脚本
frontend/
    index.html              # 主HTML文件
    css/                    # 样式文件
    js/                     # JavaScript模块
        api.js              # API客户端
        auth.js             # 认证模块
        config.js           # 配置文件
        finance-management.js  # 财务管理模块
        purchase-management.js # 进货管理模块
        sale-management.js     # 销售管理模块
        script.js           # 主脚本文件
        user-management.js  # 用户管理模块
```

### 业务流程

1. **图书销售流程**
   - 在销售管理页面选择图书
   - 输入销售数量和价格
   - 提交销售记录
   - 系统自动更新库存和财务记录

2. **进货流程**
   - 创建新进货单
   - 添加已有图书或新书明细
   - 保存进货单
   - 付款确认，系统更新库存和财务记录
   - 对于新书，设置零售价并添加到库存

3. **财务统计流程**
   - 系统自动记录所有销售和进货的财务影响
   - 在财务管理页面查看统计数据
   - 生成月度财务报表
   - 分析销售利润情况
